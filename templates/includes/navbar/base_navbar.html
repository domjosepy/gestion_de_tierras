
<!-- Notificaciones globales -->
<li class="nav-item dropdown mx-1">
    <a class="nav-link dropdown-toggle" href="#" id="notificacionesDropdown" role="button"
       data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-bell"></i>

        {% if notificaciones_no_leidas > 0 %}
            <span class="badge bg-danger rounded-pill">
                {{ notificaciones_no_leidas }}
            </span>
        {% endif %}
    </a>
    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-notificaciones" aria-labelledby="notificacionesDropdown">
        {% for n in notificaciones_recientes %}
            <li class="dropdown-item {% if not n.leida %}fw-bold{% endif %}">
                {% if n.link %}
                    <a href="{{ n.link }}" class="text-decoration-none">{{ n.mensaje }}</a>
                {% else %}
                    {{ n.mensaje }}
                {% endif %}
                <small class="text-muted d-block">{{ n.creado|date:"d/m/Y H:i" }}</small>
            </li>
        {% empty %}
            <li class="dropdown-item text-muted">Sin notificaciones</li>
        {% endfor %}

        <li><hr class="dropdown-divider"></li>
        <li>
            <a href="{% url 'notificaciones:lista' %}" class="dropdown-item text-center">
                Ver todas
            </a>
        </li>
        {% if notificaciones_no_leidas > 0 %}
        <li>
            <a href="{% url 'notificaciones:marcar_todas_leidas' %}" class="dropdown-item text-center text-primary">
                <i class="bi bi-check-all"></i>
                Marcar todas como leídas
            </a>
        </li>
        {% endif %}
    </ul>
</li>


<!-- Fin Notificaciones globales -->
 <script>
document.addEventListener("DOMContentLoaded", function() {
    const btn = document.getElementById("btnMarcarLeidas");
    if (btn) {
        btn.addEventListener("click", function() {
            fetch("{% url 'notificaciones:marcar_todas_leidas' %}", {
                method: "POST",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}",
                    "X-Requested-With": "XMLHttpRequest",
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Resetear contador de la campanita
                    const badge = document.querySelector("#notificacionesDropdown .badge");
                    if (badge) badge.textContent = "0";

                    // Opcional: cambiar estilo de las no leídas en el dropdown
                    document.querySelectorAll(".dropdown-menu .bg-primary").forEach(el => {
                        el.classList.remove("bg-primary");
                    });
                }
            });
        });
    }
});
</script>