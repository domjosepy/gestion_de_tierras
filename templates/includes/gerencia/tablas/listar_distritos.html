{% extends 'base.html' %}
{% load static %}
{% block title %}Gerencia - Distritos{% endblock %}
{% block content %}
  <div class="container fade-in py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2 class="text-success fw-bold mb-0">
        <i class="fas fa-map me-3"></i>Distritos
      </h2>
    </div>
    <div class="card shadow-sm border-0 rounded-4">
      <div class="card-body">
        <div class="table-container">
          <table class="beautiful-table" id="TablaDistritos" width="100%" cellspacing="0">
            <thead class="table-light">
              <tr>
                <th class="text-center">#</th>
                <th class="text-center">Departamento</th>
                <th class="text-center">Código</th>
                <th class="text-center">Distrito</th>
                <th class="text-center">Colonias Asignadas</th>
                <th class="text-center">
                  Acciones
                  <button class="btn btn-sm btn-primary" 
                          data-bs-toggle="modal" 
                          data-bs-target="#crearDistritoModal"
                          title="Agregar Distrito">
                    <i class="fas fa-plus"></i>
                    <i class="fas fa-map"></i>
                  </button>
                </th>
              </tr>
            </thead>
            <tbody>
              {% for dist in distritos %}
              <tr>
                <td class="text-center">{{ forloop.counter }}</td>
                <td class="text-center">
                  <strong>{{dist.departamento.codigo}}. </strong>
                  {{ dist.departamento.nombre }}
                </td>
                <td class="text-center">{{ dist.codigo }}</td>
                <td class="text-center">{{ dist.nombre }}</td>
                <td class="text-center">
                  <span class="badge {% if dist.colonias.count > 0 %}bg-primary{% else %}bg-secondary{% endif %} rounded-pill">
                    <i class="fas fa-city me-1"></i>
                    {{ dist.colonias.count }} colonia{{ dist.colonias.count|pluralize }}
                  </span>
                </td>
                <td class="text-center">
                  <!-- Botón Editar -->
                  <button class="btn btn-warning btn-sm me-1 editar-distrito-btn"
                          data-id="{{ dist.id }}"
                          data-nombre="{{ dist.nombre }}"
                          data-codigo="{{ dist.codigo }}"
                          data-departamento="{{ dist.departamento.id }}"
                          data-bs-toggle="modal"
                          data-bs-target="#editarDistritoModal"
                          title="Editar">
                    <i class="fas fa-edit"></i>
                  </button>

                  <!-- Botón Eliminar -->
                  {% if not dist.colonias.exists %}
                    <button class="btn btn-danger btn-sm eliminar-distrito-btn"
                            data-id="{{ dist.id }}"
                            data-nombre="{{ dist.nombre }}"
                            data-codigo="{{ dist.codigo }}"
                            data-departamento="{{ dist.departamento.nombre }}"
                            data-colonias="{{ dist.colonias.count }}"
                            data-bs-toggle="modal"
                            data-bs-target="#eliminarDistritoModal"
                            title="Eliminar">
                      <i class="fas fa-trash"></i>
                    </button>
                  {% else %}
                    <button class="btn btn-sm btn-outline-danger" 
                            title="No se puede eliminar un distrito con colonias asignadas" 
                            disabled>
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  {% endif %}

                  <!-- Botón Agregar Colonia -->
                  <button class="btn btn-sm btn-primary crear-colonia-btn"  
                          title="Agregar Colonia"
                          data-bs-toggle="modal"
                          data-bs-target="#crearColoniaDesdeDistritoModal"
                          data-id="{{ dist.id }}"
                          data-nombre="{{ dist.nombre }}">
                    <i class="fas fa-plus"></i>
                    <i class="fas fa-tractor"></i>
                  </button>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="6" class="text-center text-muted">No hay Distritos registrados.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>  
  </div>

  <!-- Modales -->
  {% include 'includes/gerencia/modal/distritos/crear_distrito_modal.html' %}
  {% include 'includes/gerencia/modal/distritos/editar_distrito_modal.html' %}
  {% include 'includes/gerencia/modal/distritos/eliminar_distrito_modal.html' %}
  {% include 'includes/gerencia/modal/distritos/crear_colonia_desde_distrito_modal.html' %}

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // Inicializar DataTable
    new simpleDatatables.DataTable('#TablaDistritos', {
      perPage: 10,
      labels: {
        placeholder: "Buscar...",
        perPage: "Registros por página",
        noRows: "No se encontraron Distritos registrados",
        info: "Mostrando {start} a {end} de {rows} Distritos"
      }
    });
  });
  </script>
{% endblock %}