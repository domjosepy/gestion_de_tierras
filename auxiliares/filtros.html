EDITAR Departamento
<form id="editarDeptoForm" class="needs-validation" novalidate action="{% url 'gerencia:editar_departamento' departamento.id %}" method="post">
Final de EDITAR Departamento
<!-- Filtros para Distritos y departamentos -->
    <div class="card shadow mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-4">
                    <label for="departamento" class="form-label">Departamento</label>
                    <select name="departamento" id="departamento" class="form-control">
                        <option value="">Todos los departamentos</option>
                        {% for dept in departamentos %}
                        <option value="{{ dept.id }}" {% if request.GET.departamento == dept.id|stringformat:"s" %}selected{% endif %}>
                            {{ dept.nombre }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="q" class="form-label">Buscar</label>
                    <input type="text" class="form-control" id="q" name="q" 
                           value="{{ request.GET.q }}" placeholder="Buscar distrito...">
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary me-2">
                        <i class="fas fa-search me-1"></i> Filtrar
                    </button>
                    <a href="{% url 'gerencia:listar_distritos' %}" class="btn btn-secondary">
                        <i class="fas fa-undo me-1"></i> Limpiar
                    </a>
                </div>
            </form>
        </div>
    </div>
    <!-- Fin Filtros -->

    <!-- Filtros Colonias y Distritos -->
    <div class="card shadow mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-3">
                    <label for="distrito" class="form-label">Distrito</label>
                    <select name="distrito" id="distrito" class="form-control">
                        <option value="">Todos los distritos</option>
                        {% for distrito in distritos %}
                        <option value="{{ distrito.id }}" {% if request.GET.distrito == distrito.id|stringformat:"s" %}selected{% endif %}>
                            {{ distrito.nombre }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="estado" class="form-label">Estado</label>
                    <select name="estado" id="estado" class="form-control">
                        <option value="">Todos los estados</option>
                        {% for estado in estado_choices %}
                        <option value="{{ estado.0 }}" {% if request.GET.estado == estado.0 %}selected{% endif %}>
                            {{ estado.1 }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="q" class="form-label">Buscar</label>
                    <input type="text" class="form-control" id="q" name="q" 
                           value="{{ request.GET.q }}" placeholder="Buscar colonia...">
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary me-2">
                        <i class="fas fa-search me-1"></i> Filtrar
                    </button>
                    <a href="{% url 'gerencia:listar_colonias' %}" class="btn btn-secondary">
                        <i class="fas fa-undo me-1"></i> Limpiar
                    </a>
                </div>
            </form>
        </div>
    </div>


    def crear_departamento(request):
    form = DepartamentoForm(request.POST)
    if form.is_valid():
        # Buscar el menor n√∫mero faltante antes de guardar
        codigos_existentes = set(Departamento.objects.values_list('codigo', flat=True))
        codigo = 1
        while codigo in codigos_existentes:
            codigo += 1
        departamento = form.save(commit=False)
        departamento.codigo = codigo
        departamento.save()

        messages.success(request, f'Departamento "{departamento.nombre}" creado exitosamente!')
        notificar_a_admins(
            mensaje=f'Se ha creado un nuevo Departamento: "{departamento.nombre}".',
            tipo="INFO",
            exclude_user=request.user,
            link=reverse("gerencia:listar_departamentos")
        )
        
        if request.headers.get('x-requested-with') == 'XMLHttpRequest':
            return JsonResponse({
                'success': True,
                'message': f'Departamento "{departamento.nombre}" creado exitosamente!',
                'departamento': {
                    'id': departamento.id,
                    'codigo': departamento.codigo,
                    'nombre': departamento.nombre,
                    'distritos': 0
                }
            })

        # Normal
        messages.success(request, f'Departamento "{departamento.nombre}" creado exitosamente!')
        return redirect('gerencia:listar_departamentos')
    
    # Errores
    if request.headers.get('x-requested-with') == 'XMLHttpRequest':
        return JsonResponse({'success': False, 'errors': form.errors}, status=400)
    
    messages.error(request, 'Error al crear el departamento.')
    return redirect('gerencia:listar_departamentos')
